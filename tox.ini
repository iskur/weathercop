[tox]
envlist = py313

[testenv]
description = Run tests against installed wheel to catch circular imports etc
allowlist_externals =
                    rm
                    sh
                    uv
                    pytest
                    python
commands_pre =
             rm -rf dist
             uv pip install cython numpy setuptools build scipy sympy networkx varwg
             python setup.py build_ext --inplace
             python scripts/generate_ufuncs.py
             uv build
             uv pip install .[test]
commands =
         sh -c 'uv pip install dist/*.whl'
         pytest --pyargs weathercop -n auto -m "not memory_intensive" --durations=10 -v
         pytest --pyargs weathercop -n 1 -m "memory_intensive" --durations=10 -v
