# Contributing to WeatherCop

Thank you for your interest in contributing to WeatherCop! This document provides guidelines for contributing to the project.

## Getting Started

### Prerequisites

- Python ≥ 3.13
- [uv](https://docs.astral.sh/uv/) package manager (recommended)
- Git

### Setting Up Development Environment

1. **Clone the repository:**
   ```bash
   git clone https://github.com/iskur/weathercop.git
   cd weathercop
   ```

2. **Install dependencies:**
   ```bash
   uv sync --group dev
   ```

3. **Build Cython extensions:**
   ```bash
   python setup.py build_ext --inplace
   ```

4. **Run tests to verify setup:**
   ```bash
   pytest
   ```

### Testing CI Workflows Locally

To test GitHub Actions workflows locally using [act](https://github.com/nektos/act):

1. **Create a fine-grained personal access token** at https://github.com/settings/personal-access-tokens/new
   - Repository access: All repositories
   - Permissions: contents (read)

2. **Set the environment variable:**
   ```bash
   export GITHUB_ACT_TOKEN="ghp_..."
   ```

3. **Run workflows:**
   ```bash
   act -j test-build
   ```

## Development Workflow

### Making Changes

1. **Create a new branch:**
   ```bash
   git checkout -b feature/your-feature-name
   ```

2. **Make your changes** following the code style guidelines below

3. **Run tests:**
   ```bash
   pytest
   # Or for specific tests:
   pytest src/weathercop/tests/test_vine.py
   ```

4. **Check code style:**
   ```bash
   flake8 src/
   black --check --line-length 79 src/
   ```

5. **Commit your changes:**
   ```bash
   git add .
   git commit -m "Brief description of changes"
   ```

### Code Style

- **Line length:** 79 characters (configured in `pyproject.toml`)
- **Formatter:** Black with line-length=79
- **Linter:** flake8
- **Documentation:** Use docstrings for all public functions and classes
- **Type hints:** Encouraged but not required

Format code before committing:
```bash
black --line-length 79 src/
```

### Testing

- Write tests for new features in `src/weathercop/tests/`
- Ensure all tests pass before submitting a pull request
- Use `pytest --pdb` for interactive debugging when needed
- Test data generation utilities are in `src/weathercop/tests/generate_test_data.py`

### Documentation

- Update README.org (not README.md - it's auto-generated)
- Update CHANGELOG.md for notable changes
- Add docstrings to new functions and classes
- Update DEPENDENCIES.md if adding new dependencies

## Cython Extensions

WeatherCop uses Cython for performance-critical code:

- **Manual `.pyx` files:** In `src/weathercop/` (e.g., `cvine.pyx`, `cinv_cdf.pyx`)
- **Auto-generated code:** In `src/weathercop/ufuncs/` (generated by SymPy)
- **Do not edit** files in `ufuncs/` manually - they're regenerated on build

After modifying Cython code:
```bash
python setup.py build_ext --inplace
```

## Pull Request Process

1. **Update documentation** as needed
2. **Add tests** for new functionality
3. **Update CHANGELOG.md** under the [Unreleased] section
4. **Ensure all tests pass:** `pytest`
5. **Check code style:** `flake8 src/` and `black --check --line-length 79 src/`
6. **Submit pull request** with clear description of changes

### Pull Request Guidelines

- Keep PRs focused on a single feature or bug fix
- Include tests demonstrating the fix or feature
- Update documentation to reflect changes
- Reference any related issues in the PR description

## Reporting Issues

When reporting bugs, please include:

- Python version and platform (Linux, macOS, Windows)
- WeatherCop version or commit hash
- Steps to reproduce the issue
- Expected vs. actual behavior
- Error messages and stack traces (if applicable)

## Project Structure

```
weathercop/
├── src/weathercop/        # Main package source
│   ├── copulae.py        # Copula implementations
│   ├── vine.py           # Vine copula structures
│   ├── seasonal_cop.py   # Seasonal copulas
│   ├── multisite.py      # Multisite weather generation
│   ├── ufuncs/           # Auto-generated Cython extensions
│   └── tests/            # Test suite
├── docs/                  # Documentation and experiments
├── examples/              # Example configurations
├── README.org            # Main documentation (source)
├── README.md             # Generated from README.org
├── CHANGELOG.md          # Version history
├── DEPENDENCIES.md       # Dependency documentation
└── CONTRIBUTING.md       # This file
```

## Questions or Need Help?

- Open an issue for questions about contributing
- Check existing issues and pull requests first
- Be respectful and constructive in discussions

## License

By contributing to WeatherCop, you agree that your contributions will be licensed under the MIT License.

---

Thank you for contributing to WeatherCop!
